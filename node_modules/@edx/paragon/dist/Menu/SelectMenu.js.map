{"version":3,"file":"SelectMenu.js","names":["React","useState","useEffect","useCallback","PropTypes","classNames","ExpandMore","Button","ModalPopup","useToggle","Menu","withDeprecatedProps","DeprTypes","SELECT_MENU_DEFAULT_MESSAGE","SelectMenu","_ref","defaultMessage","children","className","variant","props","_objectWithoutProperties","_excluded","triggerTarget","setTriggerTarget","focusMenuRef","useRef","itemsCollection","useMemo","Array","from","length","map","createRef","defaultIndex","i","defaultSelected","undefined","selected","setSelected","isOpen","open","close","createMenuItems","Children","child","index","newProps","onClick","e","current","id","toString","role","cloneElement","prevOpenRef","numItems","scrollIntoView","block","focus","preventScroll","createElement","_extends","ref","iconAfter","placement","positionRef","onClose","modifiers","name","options","padding","top","bottom","key","propTypes","string","node","isRequired","defaultProps","SelectMenuWithDeprecatedProp","isLink","deprType","MOVED_AND_FORMAT","message","newName","transform"],"sources":["../../src/Menu/SelectMenu.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { ExpandMore } from '../../icons';\nimport Button from '../Button';\nimport ModalPopup from '../Modal/ModalPopup';\nimport useToggle from '../hooks/useToggle';\nimport Menu from '.';\nimport withDeprecatedProps, { DeprTypes } from '../withDeprecatedProps';\n\nexport const SELECT_MENU_DEFAULT_MESSAGE = 'Select...';\n\nfunction SelectMenu({\n  defaultMessage,\n  children,\n  className,\n  variant,\n  ...props\n}) {\n  const [triggerTarget, setTriggerTarget] = useState(null);\n  // this ref is used to focus the menu open button after any menu option is clicked.\n  // triggerTarget.current.focus() inside the onCLick() function didn't guarantee element focus.\n  const focusMenuRef = React.useRef(false);\n  const itemsCollection = React.useMemo(\n    () => Array.from({ length: children.length }).map(() => React.createRef()),\n    [children.length],\n  );\n\n  const defaultIndex = useCallback(() => {\n    for (let i = 0; i < children.length; i++) {\n      if (children[i].props && children[i].props.defaultSelected) {\n        return i;\n      }\n    }\n    return undefined;\n  }, [children]);\n\n  const [selected, setSelected] = useState(defaultIndex());\n  const [isOpen, open, close] = useToggle(false);\n\n  const createMenuItems = () => React.Children.map(children, (child, index) => {\n    const newProps = {\n      onClick(e) {\n        if (child.props.onClick) {\n          child.props.onClick(e);\n        }\n        setSelected(index);\n        close();\n        focusMenuRef.current = true;\n      },\n      id: `${index.toString()}_pgn__menu-item`,\n      role: 'link',\n    };\n    if (selected === index) {\n      newProps['aria-current'] = 'page';\n    }\n    return React.cloneElement(child, newProps);\n  });\n\n  const prevOpenRef = React.useRef();\n\n  useEffect(() => {\n    if (isOpen && selected) {\n      const numItems = children.length;\n      if (numItems > 6 && selected > 1 && numItems - selected > 2) {\n        // on \"middle elements\", set offset to center of block and scroll to center\n        itemsCollection[selected].current.children[0].scrollIntoView({\n          block: 'center',\n        });\n      }\n    }\n    // set focus on open\n    if (isOpen && !prevOpenRef.current && selected) {\n      itemsCollection[selected].current.children[0].focus({ preventScroll: (defaultIndex() === selected) });\n    }\n    if (focusMenuRef.current) {\n      triggerTarget.focus();\n      focusMenuRef.current = false;\n    }\n    prevOpenRef.current = isOpen;\n  }, [isOpen, children.length, defaultIndex, itemsCollection, selected, triggerTarget]);\n\n  return (\n    <div className={classNames('pgn__menu-select', className)} {...props}>\n      <Button\n        aria-haspopup=\"true\"\n        aria-expanded={isOpen}\n        ref={setTriggerTarget}\n        variant={variant}\n        iconAfter={ExpandMore}\n        onClick={open}\n      >\n        {selected !== undefined && children[selected] ? children[selected].props.children : defaultMessage}\n      </Button>\n      <div className=\"pgn__menu-select-popup\">\n        <ModalPopup\n          placement=\"bottom-start\"\n          positionRef={triggerTarget}\n          isOpen={isOpen}\n          onClose={close}\n          modifiers={\n            [\n              {\n                name: 'flip',\n                options: {\n                  padding: { top: 150, bottom: 150 },\n                },\n              },\n            ]\n          }\n        >\n          <Menu aria-label=\"Select Menu\">\n            {createMenuItems().map((child, index) => (\n              <div key={child.props.id} ref={itemsCollection[index]}>\n                {child}\n              </div>\n            ))}\n          </Menu>\n        </ModalPopup>\n      </div>\n    </div>\n  );\n}\n\nSelectMenu.propTypes = {\n  /** String that is displayed for default value of the ``SelectMenu`` */\n  defaultMessage: PropTypes.string,\n  /** Specifies the content of the ``SelectMenu`` */\n  children: PropTypes.node.isRequired,\n  /** Specifies class name to append to the base element */\n  className: PropTypes.string,\n  /** Specifies variant to use. */\n  variant: PropTypes.string,\n};\n\nSelectMenu.defaultProps = {\n  defaultMessage: SELECT_MENU_DEFAULT_MESSAGE,\n  className: undefined,\n  variant: 'outline-primary',\n};\n\nconst SelectMenuWithDeprecatedProp = withDeprecatedProps(SelectMenu, 'SelectMenu', {\n  isLink: {\n    deprType: DeprTypes.MOVED_AND_FORMAT,\n    message: 'Use \"variant\" prop instead, i.e. variant=\"link\"',\n    newName: 'variant',\n    transform: () => 'link',\n  },\n});\n\nexport default SelectMenuWithDeprecatedProp;\n"],"mappings":"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"}